Laboratoire 1

****

Optimiser la densité d’implantation d’arbres dans les parcs de Montréal (problématique factice)

****

[**Pré requis**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.hgyuo2ihqxc)

[**Déroulement et explications**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.krc72fxjud2t)

[**Problématique à résoudre**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.dwefjrz9ycku)

[**Outils**** ****2**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.j4o5xbwnydw)

[**Analyse de la densité arboricole par parc**** ****3**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.9y5jzn4jbbgt)

[Étape 1 3](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.2h1l4keql873)

[Étape 2 3](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.y70xrg74r05)

[Étape 3 4](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.a0okjhrnmipm)

[Étape 4 5](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.me89d8pa70ld)

[Étape 5 6](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.rh09lfv567oy)

[Étape 6 7](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.2qe3big3iyaf)

[Étape 7 8](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.rdp879ypce4f)

[Étape 8 9](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.qakgwoaln4nu)

[Étape 9 9](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.ekld72m2o1jc)

[Étape 10 10](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.1o6tvjnl458f)

[Étape 11 11](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.5hzoozmhqh8l)

[Étape 12 12](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.20hn7tcfuogi)

[Étape 13 13](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.ui1ppatir77c)

[Étape 14 13](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.qq7mgwvaoaz0)

[**Analyse de la densité arboricole grille H3**** ****14**](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.yziuu8mehgxl)

[Étape 1 14](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.tlx69s3qe7pr)

[Étape 2 15](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.febn6xa5a9bf)

[Étape 3 15](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.5flvbl875s4m)

[Étape 4 16](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.x2nnolvlcr9r)

[Étape 5 16](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.y8vh9yu4tbfx)

[Étape 6 16](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.un94tv301m0q)

[Étape 7 17](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.102x5d82x7kd)

[Étape 8 17](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.614sjo1tqtnq)

[Étape 9 18](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.tdp03zesh1ec)

[Étape 10 19](https://docs.google.com/document/d/1HlB3fWprIa065k5GXIVYk9o06-TrNycb_xS-U8FEG-4/edit#heading=h.iycmwzqyfimg)

****

****


# Pré requis

****

- [Oracle VM Virtual box](https://www.virtualbox.org/wiki/Downloads)
- [L’image de la machine virtuelle pour installer votre environnement de travail](https://drive.google.com/file/d/1ectuc8jB1ZE8aR7vCVyrGHZ1ElUbOhjC/view?usp=share_link)


# Déroulement et explications

****

Chaque laboratoire aura un thème, une problématique particulière, il faudra résoudre la problématique avec les logiciels demandé

****


# Problématique à résoudre

****

Optimiser la densité d’implantation d’arbres dans les parcs de Montréal

****


# Outils

FME et QGIS


# Analyse de la densité arboricole par parc

****


## Étape 1

****

Lire les données nécessaires depuis le site des données ouvertes:

- Arbres (points) (csv)
- Parcs (polygones) (geojson)

****

Indice :  Ne trouver que l’URL

****


## Étape 2

1. Ouvrir FME
2. Créer un WB vide
3. Ajouter un READER CSV
4. Choisissez l’option URL

 

![](https://lh3.googleusercontent.com/y_jPd1c68RO0g7uDMYf-OgAu-QpmbzKwSEL2vyPfNtZWqnZ4WpjmCHyq4Q-zo9svXC3PSqcXZEmlj_JRKreOr0DKfOhcvgnVfaynlMGO7SbcPQqpKHjl5ho4XjFMkuYqLDhMugd12R61vuHwDcWuo9iYz1lRfbY-pOSgiQA-YlTOqBifywpb_LtJzzvH_w)


## Étape 3

1. Ajouter un READER Geojson
2. Choisissez l’option URL 

****

Assurez vous que vos données sont chargées correctement avec l’option JUST RUN THIS

![](https://lh4.googleusercontent.com/zntqfrQ_cqCqACNSavmdK57QLA4aAAUu0p-Ht1fdN5TjjWPhrDrSrwSiNN5wGIo-UoVbfUgrXp6HokCHT28RB2ct0Y1KtDf4Bq5W_a8-hMp2RZHMSfuqZfqcGp4orXQwmN3B965dePppHa2jJgTYqLr113BMX0wszt4nQLeSulx-X8Dfi9xPuSUdZiQ9Wg)

****

Assurez vous que l’option ENABLE FEATURE CACHING soit bien activée

****

![](https://lh4.googleusercontent.com/t6wqxUM-TPjKNCuuYyi7C_DkGTBPvyDxoB-f2thFKzuevhb8uSlozUiE1gfvmkOyT3VYnqJYlVuzCVRZ9eJrsUDlwwytP_1qQUOqmMxArUxGX2JlPHhgt1Sh9OUvLx_8UpYt5nVBJA_yB8RyvzNpy3V4ItF9TD54I8XGh45kDNfz_uEYoxwKb9iYiAi2ow)

****

Vous allez ensuite pouvoir inspecter vos données avec l’inspecteur (icone de loupe ou d’oeil)

![](https://lh3.googleusercontent.com/ONcbAtJW_6IzXkkXoC12M8faGDbGHCIdZqccJfWGv1EyqswlbFZVqG0rfx5hjL01BERc6OXmJ2i821MyixWhBx5n-z6kN5qBKZ2X62xOg8r9G7GoVQJ1wR4Ho3tIr57BNqHF-H2NoG8mEgFaIed3soe9Hzia-k4UEyj8Z-yaEgbhl7sjcjqj0YA7p2QGWw)

![](https://lh5.googleusercontent.com/khiQUfQFuApbyhLe_BXmbgA8A62lpPBXVu1c0gUYod0eIF7t2LHJCDquUsnJ60qaD27S_nZDQXBhPhz1q1xCueZdImM_xkSakC4qJLHwChZKhdGnCVBKRwIbuGWAOdEcczlzgvfOCEqQtItmqQdCYEg6zn9aDbhlVen5bB891DdHPMJgylby3HvORC7Jvg)


## Étape 4 

****

Reprojeter les données (parcs et arbres) en 3857 à l’aide du TRANSFORMERS : reprojector

****

![](https://lh5.googleusercontent.com/FWm6VFvNzJtqT-8peo3dmbXcL4qxWR8tZLEHHEeFEKSUOw-nO01nLzDig-aSEMAqSlY8sL_hI8QPMZ8-0AHsj2HhSfB07ZBDP0UwE0ra3pwpENf5-hzWizNOSbFo31iTNkkYzwXRxIxJbmIW7Zmfz4wP5PK3-UqFIDkJFtvEoSRpjOVjeCncVfSOoRH39w)

****


## Étape 5

****

Faire une jointure spatiale pour compter le nombre d’arbres dans chaque parc, avec le TRANSFORMERS : PointOnAreaOverlayer

****

![](https://lh4.googleusercontent.com/JHmvQgXS3cZWapwEVE82gInkEEM4jC2mLBpF31tNgxJ8bFldzOKyGFtnBVm-bTBo97KRIl9tej5dIWfi-IBCfyndTu86RsLWMBZaERfNmsEP5HUQCnXr5jqpNXG3dtZ4jG2getHIiBpLBUEf_hiJgbvn5xC4wYRbroDmWHSbZzLgMIURGF7nXsrzxCKlJQ)

****


## 


## Étape 6

****

On choisit seulement les attributs nécessaires dans la nouvelle couche de données avec le transformer ATTRIBUTEKEEPER

****

![](https://lh4.googleusercontent.com/7iqOxBav2G_rwsPVG2VldIZNmJL03Xp9HFZQjjMoJXKlHsRQWU51-7V7dses6vsqlkBR7W85wdwHASJSL9F4iPxS7nIfLj07LbbNwxCKGHdyWZmrseEf-z9GqVquy9sWhn1OsMgP6CUWkqgdmxnFuulqj9pFTWf7nvYLZ1vTf5ovna7vIvTIi01dXsWivw)

****

On n’oublie pas d’attacher une boite de LOG aux features qui sont rejetées pour ne pas créer de goulot, car le processus risque de s’arrêter si vous avez des _“erreurs”_

****

_(cliquez droit sur la petite flèche grise pour faire apparaître l’option de connexion_

****

_![](https://lh3.googleusercontent.com/b6T748vI8UWlpsqCvcVEwo5UhllIGvKilwgTy5w_L_ojm5N7ebQyx10-PZOAy32AIgutU_Fn6CZchs6rto9MCUOv7KV2zYVsEPQ0YqkdF-2BYn37r-JpxzPElkCInz_u0rLW9R3Q-0fNoEwawQtJ1WJ1iM821ZOASsYwvPOLKt1bsOyMpUKyh6CLGz9cww)_

****

_![](https://lh6.googleusercontent.com/r38iFX731vxkT8uOMXk8SGSGD5oegyIC-7nH3C9p6cyDuIIBu1hpJP0P12EXWrDbBI51LF14V16xo3dwl50UkoF90FeRoqdlk_AP2NKSYJJQkMaetkYKLYp_1vfl3C2Dc1dzMrY79UhPEJSBaO8O2eYU_Q2XKVjuuJ3yEZYNsfrmgVcWeji0xK-bcojzaw)_

****


## Étape 7

****

On calcule la densité d’arbres par m2 par parc

****

Ajouter un attribut avec le TRANSFORMERS : AttributeCreator

****

![](https://lh5.googleusercontent.com/dirrdK4qu0yVxSb6-c7D0UK2QI8h0UaZWQV66yTVLCnOvSnjGM9rUbMjZj3NS5hR-ziJUtaKaWGiZKk-VvfErrVINmfHL-6E-cC0jVpnSWXyyBdyDIFlWScnAVexzhMV3j52wrjMBvG4ok7uH6nypdy41-eOD48V1VPY_0Vncaib_aPE1uEIYtumqexABQ)

****


## 


## Étape 8

****

Renommer les champs pour une meilleur lisibilité avec le TRANSFORMER : attributeManager

![](https://lh3.googleusercontent.com/9jCfxymqAJsES36E4sim_KbwoRmn5CcEQqAP-QkeZT0Gf1i05D-PLoQUd0XyecemwfGqXR4LonMMmPhxjxIuebZlQAyzZFyBPSiO9XWygP9xySt6q5FfjnD-7lOnA4VXVArcI4JrwBr-AxfPe7LMXivCvK-p4NIJevIZpcHY6ZgVDalzdUnYINWJ7_2s0Q)

****


## Étape 9

Calcul de la médiane de densité

****

Avec le TRANSFORMERS : StatisticsCalculator vous pouvez calculer toutes sortes de statistiques sur un ensemble de données

****

Calculer la médiane pour les 2 variables suivantes : tree_count, tree_density

****

![](https://lh4.googleusercontent.com/BvODxtGf56Pe6cd6vqscmOeFp5NX0rr6tWq-tFb5RnFecwHIX55t7qKlucGLVFTaGoPjInpxxz-4CD4v56xhnx-k06T-h97hBHzvbxWRyn99IMe9owvuTl9L2Q42GM0ohQ2IT7rN9UP3jTh84YFLfZgbnUKAx4gDNYwdiovhx2-dsSgfqXRUdTdDjYG8NQ)

****


## 


## Étape 10 

Calcul de l’index par rapport à la moyenne

****

Transformers : AttributeManager

****

![](https://lh4.googleusercontent.com/G_HmmwSmxUSOnFi_hCEbqt2v6oicIeZEWTJ8Cw34qP5CvDx-JzqDBm2U3u5MUP0RIAsg658QBSYkhixiZQl0bPPB2DdBqhoX5o4FXBctOmjRfyOm9NKKXYBhiaXhX9ASLtt853rQl5gVmgjIpeg8wtHDWNvmFPeJthU1IbJUirmLvR7kxTTbAHJiOCRMrA)

****


## 


## Étape 11

 Nettoyage des données

****

On ne veut pas de données vides, ou avec des caractères spéciaux, on veut une BD uniformes avec des valeurs de type null si les données sont vides.

****

Transformers : NullAttributeManager

****

![](https://lh4.googleusercontent.com/a_hRB0bK8vM9ISV_1UysNYos-uiBFUJEz_iEi7kHa60a2MNCWZDco7RA4nBU4HGfeUHm2LNJdxG2gHULxt36QlArlmlglM-VOqLL_250geUVdrKBTPPToo8cxqZZjLsVZs358egF0AbrmaFNVQ0Ku_RpPPuJOhwu57Ib4YjI4PcJz9NGPhAHoV6e8e-wQw)

****


## 


## Étape 12

****

Écrire la table dans la base de données Postgis

****

Créer la connexion dans les propriétés de FME (mot de passe _myscecretpassword_)

**![](https://lh5.googleusercontent.com/EpAbX0pU_KqjbMvFM3TgdRbhD_jwLz-6zYPZdfsPXmg0K46TWEh_dgSnI2UeSmakjJMt1wIuZwpzp77zLFrFmdSih2hi_Pa2kLItdQXD5dsfJj167e7Il2yyArfUpEcbdSQ13rYv7F1cgoULnWG-InMG08FXWuE843LUmgVcuiv9MtrnV-s7-K846IhB3g)**

![](https://lh6.googleusercontent.com/Kvt6dVBUEFva4CVz-XtE4b6oDhQ_bm5WdiaqzB34F9mU5InrEBC7FbvdnKEsADZ_Edud6m0B22PuqNrnOJeiA8jxhqhCAw5zYUsQggzDeNvxlhY-IM_Qxe4mItn2vijQ0QayjRFP_PrO44Leb4X5oUSBil-35hT2fiHunIfRvcO0wn0lWJLPsxLuVgl1mA)

![](https://lh4.googleusercontent.com/6q3qoCsXhQeXneZGMWigpF12-bR5vkjMxX2nAgbpAI3IPOGaNkbJ2PNwzen9qk2jNMk9wyeK31X_ZPsbASMaAyqJt5zsArzRQhB0dsUdHV1zinYL9VpBphQM_fHm4Fj3hcXy4Yi9Iu49vdb5qkvGMUrP-gYA_9Ldmw-tCLzGISpfY8j73edYoV6c2svqMg)

****

Writer : Postgis

****

![](https://lh4.googleusercontent.com/fjqc3pm0A3EnCd_SNiMruC2VmwkrsUCDi1kfnUxVE1-9j0vP8OezsT6DMIHln6ihGJtY3P3paCVrrxrXQysdFeZ6xsqNCD4wX9C0oyo7_H94YKeG7wHzpG7qnMU9IuAHvpxYYfVpqLTYXawVHYFn63a3sj0TnhkP92OmBcQxAP4f-6FVwZsEsDYTWSy9LA)

****


## Étape 13 

****

Ouvrir la table dans QGIS

****

![](https://lh4.googleusercontent.com/Llle2QbnpR8IVT9otP8hE4lIrqgUxlJ5r5lHcySGeH3QdvdAnI-IaairpHeTmd1Ah03NjztCmBAkvSWzfpu6rFL_YhH_cOeXGmW2xyrYtycAVqhs9WnvvIAbCaHwGINVMdQc37l-S5VKpwMumdnFhbhb4AlGQziFRq7Lm31buwUJeAUzzYxXJ6IVDhAtaQ) 


## Étape 14

****

Sauvegarder le style .sld et dans la BD![](https://lh6.googleusercontent.com/mTo6S80CioWtd6fO5onl-KxkYyVLovW1O6V7ym-EjbVmZ7ZPPFFINa56pm-2mRxANXVf_1W43m4h3dJ5I1kPzejNAdxY9mBWozwFWk_vA2QE6Mp9WFd79pYVPU7LiETudkC3HzAZgRRcj7op52OGIdhU9anNsO7Jj7TFClSFrMnKVWGKUe9gu08mypXG8g)


# Analyse de la densité arboricole grille H3

****


## Étape 1

****

Filtre spatial

****

On souhaite extraire seulement les arbres qui se trouvent dans les parcs

****

Transformers : spatialFilter

****

![](https://lh4.googleusercontent.com/h7huo49cEY_RmXBWFRxFleur3tFLRDwaqlcYj11ilgEtRZzpbyIpgp2WExHRwjazmDIHPbJSZZWLdGxS7P-ofR6GOco4OferBdbEXV2Qp4q37e7U92Em2Ek1V0oK9X6P5pMMiWVTg4zxE2-Cywa5gvVwEFp82xhh6wmAc2kUGxmhCKgrjzqc-8rRwuAidA)


## Étape 2

Reprojection 

****

Pour générer une grille H3 nous devons passer des latitudes longitudes en 4326 

****

On n’oublie pas de mettre un logger sur les rejetés

****


## Étape 3

Création de la grille/index H3 

****

Transformers : H3HexagonalIndexer

****

![](https://lh4.googleusercontent.com/FicN_Z1QHZ5RgP5L89Aqj3JgLWdgEh7AuwTMBxmVHwIYCCMmf_-LlWWpiA2tBXYDUT9SfMsqjrU4f02Yng_fnjWL1VhqnWu664kyz5tIIURj1j1CjOJHpMGS-bdHHku923o8QWwO2n7_17S25zLlBuxldp-5cffgE_a5k5_-CTQo-WdsOH4oX1VzDzMOVg)

****

On oublie pas de mettre un logger sur les rejected au cas ou

****


## 


## Étape 4 

Dissolution (fusion) des indexes h3 par numéro d’index pour ne conserver qu’un seul hexagones par index

****

(1 arbre génère 1 hexagone dans la grille avec le H3HexagonalIndexer)

****

Transformer : Dissolver

![](https://lh6.googleusercontent.com/Xhhzfs9sxjcAHaIb34lPh5PCg_TQszKpp7y6vbUfXAwVvr3mVqvwoFSStFZ-JrZuwrUvQeiLRuABPQTZJ3vSMOdA_n5PG0mpzBe8FhbNVdwTN07fnU5BrgkpRGyX5eIIxKOFswk2A3ob3Nq_zSt8VA9m17fr6Y5LNoKPdXDiSi8pWkvkdiqSymRNVuU5bw)

****


## Étape 5

Reprojection de 4326 à 3857

****


## Étape 6

Jointure spatiale pour compter le nombre d’arbres dans chacun des index H3

****

Transformer : PointOnAreaOverlayer

****

![](https://lh4.googleusercontent.com/qPeaNT283BVQFyGYXU8X21Tp9YXmtZApTL_NZudVx4AtJusJlLgcSR95GGzMPhqFQt2YVUsONpBoRIRyoyVW0W1GvyX8aSYRdJNT1vmWYB7fpIk2Z44Vw0Z_cVmqUoUNcSKyfxPqXAu-6Lcc39XJZ7HCLJX2zW5BT6j1_jBqynk9cljFLO-iBcKxL_YVZA)

****


## Étape 7

****

On garde seulement les attributs désirés : point_count,\_geometry,\_h3index

****

Transformer : Attribute keeper

****


## Étape 8

On renomme les champs qu’on veut exporter dans la bd

****

Transformer : AttributeManager

****

![](https://lh3.googleusercontent.com/qmYINl_hBRY0j1FmnevLnhSHnlhn6dPmKOAUPZfbhsY2u7IMpM6f-qEvDBO93zhUzD9o4eRCxyIR7sPuY24NGIPORleIfxitjzChXYlXHLt_5z7SmPXWkcdadoNnufEFWas3CHprBrlumAFriXQKp5dFIZh4EZVtjqODQoJJAX611sbc1rs7DVmUK4JzSQ)

****


## Étape 9

****

On enregistre la grille H3 dans une table dans la BD locale GEO7630

****

Writers : Postgis

****

![](https://lh6.googleusercontent.com/F9V-NxIk_bhDOnv9QxeoOVaba5ZfOv2ZAlBzCD2iBTNosc51rK4b9C98LOjIUy_9z03fzgW448O5hd7JlCOLQ63WLFgZwZeBMf3ljuQ8IJ8S3mURlPJCzjzLmIGjelDx7Dq9ywBpinN-WEyAyoIaWXjB3-1YNO4lbKy4qN12K99kd95ZqloSBHxEZyWlYA)


## Étape 10

****

Ouvrir et styliser la couche dans QGIS

****

Enregistrer le .sld et enregistrer le style dans la BD

****

![](https://lh4.googleusercontent.com/d7Yd8AB-77QPWRS5yxwqeLrQc5ovhPTDYQ3brgpjeI_lXAmwcAlfTs2KZHcx6g7nVeLr_0Ox1qE-fWf7EkqaUid7aV3iqF0jRDnncen6QxFZ_lGNVCwoEWkelilmoumwOunjpYdbNyWU16g4RmdCty9wC-ktCLVB7dDqQb_mKUd3Xv7Z1EGraMcSF_xVcA)


Markdown généré avec https://mr0grog.github.io/google-docs-to-markdown/